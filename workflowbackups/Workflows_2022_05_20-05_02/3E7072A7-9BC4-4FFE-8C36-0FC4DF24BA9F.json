{"actions":[{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionShowAlert","parameters":{"button2Value":{"type":"advancedText","tokenRanges":{},"text":"restore"},"button1Title":"Create Backup","button1Value":{"type":"advancedText","tokenRanges":{},"text":"backup"},"showCancelButton":true,"title":"Create or Restore?","message":{"type":"advancedText","tokenRanges":{"{94, 1}":"%date:mm","{88, 1}":"%date:MM","{92, 1}":"%date:HH","{86, 1}":"%date:yyyy","{90, 1}":"%date:dd"},"text":"The backup of your workflows will be created as a zip file in your Dropbox (Workflows_?_?_?-?_?.zip)."},"button3Title":"","button3Value":{"type":"advancedText","tokenRanges":{},"text":""},"button2Title":"Restore..."}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionStoreVariable","parameters":{"name":"Action","value":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"If \"Backup\" was selected...","class":"WorkflowActionCondition","parameters":{"comparisonType":0,"expression2":{"type":"advancedText","tokenRanges":{},"text":"backup"},"expression1":{"type":"advancedText","tokenRanges":{"{0, 1}":"Action"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"Create the Backup (Python)","class":"WorkflowActionRunScript","parameters":{"script":"#coding: utf-8\nimport workflow\nimport editor\nimport os\nfrom zipfile import ZipFile\nimport datetime\nfrom io import BytesIO\n\nt = datetime.datetime.today()\nbackup_filename = 'Workflows_' + t.strftime('%Y_%m_%d-%H_%M') + '.zip'\nwf_path = editor.get_workflows_path()\nfiles = os.listdir(wf_path)\nzip_buffer = BytesIO()\nwith ZipFile(zip_buffer, 'w') as z:\n\tfor filename in files:\n\t\tname, extension = os.path.splitext(filename)\n\t\tif extension in ('.wkflw', '.edcmd'):\n\t\t\tz.write(filename)\n\t\nzip_data = zip_buffer.getvalue()\neditor.set_file_contents(backup_filename, zip_data, 'dropbox')\n\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionShowHUD","parameters":{"HUDText":{"type":"advancedText","tokenRanges":{},"text":"Backup Created"},"duration":1,"icon":0}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionConditionEnd","parameters":{}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"If \"Restore\" was selected....","class":"WorkflowActionCondition","parameters":{"comparisonType":0,"expression2":{"type":"advancedText","tokenRanges":{},"text":"restore"},"expression1":{"type":"advancedText","tokenRanges":{"{0, 1}":"Action"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"List Backups (Python)","class":"WorkflowActionRunScript","parameters":{"script":"#coding: utf-8\nimport workflow\nimport editor\nimport os\nimport re\n\nwf_path = editor.get_workflows_path()\ndb_path = os.path.join(os.path.split(wf_path)[0], 'Dropbox')\n\nbackups = []\nfiles = os.listdir(db_path)\nfor filename in files:\n\tif re.match('Workflows_.*\\\\.zip$', filename):\n\t\tbackups.append(filename)\nworkflow.set_output('\\n'.join(backups))\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"Stop if no backups are found...","class":"WorkflowActionCondition","parameters":{"comparisonType":0,"expression2":{"type":"advancedText","tokenRanges":{},"text":""},"expression1":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionShowAlert","parameters":{"button2Value":{"type":"advancedText","tokenRanges":{},"text":""},"button1Title":"","button1Value":{"type":"advancedText","tokenRanges":{},"text":""},"showCancelButton":false,"title":"No Backups Found","message":{"type":"advancedText","tokenRanges":{},"text":"No backup files were found. You might need to download them first, if you see grayed-out backup files in your Dropbox folder."},"button3Title":"","button3Value":{"type":"advancedText","tokenRanges":{},"text":""},"button2Title":""}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionStopWorkflow","parameters":{"showHUD":false,"HUDTitle":"","stopOption":0}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionConditionEnd","parameters":{}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionSelectFromList","parameters":{"title":"Select a Backup","list":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"},"showInPopover":false,"allowMultipleSelection":false}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"Show Warning Alert","class":"WorkflowActionShowAlert","parameters":{"button2Value":{"type":"advancedText","tokenRanges":{},"text":""},"button1Title":"Continue","button1Value":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"},"showCancelButton":true,"title":"Warning","message":{"type":"advancedText","tokenRanges":{"{91, 1}":"Input"},"text":"This will replace all your workflows with the ones that are stored in the selected backup (?)."},"button3Title":"","button3Value":{"type":"advancedText","tokenRanges":{},"text":""},"button2Title":""}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"Restore the Backup (Python)","class":"WorkflowActionRunScript","parameters":{"script":"#coding: utf-8\nimport workflow\nimport editor\nfrom os import path\nfrom zipfile import ZipFile\n\nbackup_filename = workflow.get_input()\ndb_path = path.join(path.split(editor.get_workflows_path())[0], 'Dropbox')\nbackup_path = path.join(db_path, backup_filename)\n\nwith ZipFile(backup_path, 'r') as z:\n\tz.extractall(editor.get_workflows_path())\n\neditor.reload_workflows()\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionShowHUD","parameters":{"HUDText":{"type":"advancedText","tokenRanges":{},"text":"Backup Restored"},"duration":1,"icon":0}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionConditionEnd","parameters":{}}]}