{"actions":[{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionGetFileName","parameters":{"includeFolder":false,"includeExtension":false}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionStoreVariable","parameters":{"name":"label","value":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionGetBookmarkURL","parameters":{}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionStoreVariable","parameters":{"name":"shortcutURL","value":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionRunScript","parameters":{"script":"# This script adds a \"Webclip\" shortcut to your homescreen.\n# You'll be asked for an icon (from your camera roll).\n# Path to file, file name, and root (dropbox vs local) are\n#\tdetected automatically.\n\nimport plistlib\nimport BaseHTTPServer\nimport webbrowser\nimport uuid\nfrom io import BytesIO\nimport Image\nimport photos\nimport notification\nimport console\nimport workflow\nimport editor\n\nclass ConfigProfileHandler (BaseHTTPServer.BaseHTTPRequestHandler):\n\tconfig = None\n\tdef do_GET(s):\n\t\ts.send_response(200)\n\t\ts.send_header('Content-Type', 'application\/x-apple-aspen-config')\n\t\ts.end_headers()\n\t\tplist_string = plistlib.writePlistToString(ConfigProfileHandler.config)\n\t\ts.wfile.write(plist_string)\n\tdef log_message(self, format, *args):\n\t\tpass\n\ndef run_server(config):\n\tConfigProfileHandler.config = config\n\tserver_address = ('', 0)\n\thttpd = BaseHTTPServer.HTTPServer(server_address, ConfigProfileHandler)\n\tsa = httpd.socket.getsockname()\n\twebbrowser.open('safari-http:\/\/localhost:' + str(sa[1]))\n\thttpd.handle_request()\n\tnotification.schedule('Tap \"Install\" to add the shortcut to your homescreen.', 1.0)\n\ndef main():\n\turl = workflow.get_variable('shortcutURL')\n\tlabel = workflow.get_variable('label')\n\ticon = photos.pick_image()\n\tif not icon:\n\t\treturn\n\tconsole.show_activity('Preparing Configuration profile...')\n\tdata_buffer = BytesIO()\n\ticon.save(data_buffer, 'PNG')\n\ticon_data = data_buffer.getvalue()\n\tunique_id = uuid.uuid4().urn[9:].upper()\n\tconfig = {'PayloadContent': [{'FullScreen': True,\n            'Icon': plistlib.Data(icon_data), 'IsRemovable': True,\n            'Label': label, 'PayloadDescription': 'Configures Web Clip', \n            'PayloadDisplayName': label,\n            'PayloadIdentifier': 'com.omz-software.shortcut.' + unique_id, \n            'PayloadOrganization': 'omz:software', \n            'PayloadType': 'com.apple.webClip.managed',\n            'PayloadUUID': unique_id, 'PayloadVersion': 1,\n            'Precomposed': True, 'URL': url}], \n            'PayloadDescription': label,\n            'PayloadDisplayName': label + ' (Shortcut)', \n            'PayloadIdentifier': 'com.omz-software.shortcut.' + unique_id,\n            'PayloadOrganization': 'omz:software', \n            'PayloadRemovalDisallowed': False, 'PayloadType': \n            'Configuration', 'PayloadUUID': unique_id, 'PayloadVersion': 1}\n\tconsole.hide_activity()\n\trun_server(config)\n\nif __name__ ==  '__main__':\n\tmain()\n\n"}}]}