{"actions":[{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionShowAlert","parameters":{"button2Value":{"type":"advancedText","tokenRanges":{},"text":"restore"},"button1Title":"Create Backup","button1Value":{"type":"advancedText","tokenRanges":{},"text":"backup"},"showCancelButton":true,"title":"Create or Restore?","message":{"type":"advancedText","tokenRanges":{"{138, 1}":"%date:dd","{140, 1}":"%date:HH","{142, 1}":"%date:mm","{134, 1}":"%date:yyyy","{136, 1}":"%date:MM"},"text":"The backup of your workflows, snippets, bookmarks, and local documents will be created as a zip file in your Dropbox (EditorialBackup_?_?_?-?_?.zip). Editorial needs to be linked to Dropbox for this to work."},"button3Title":"","button3Value":{"type":"advancedText","tokenRanges":{},"text":""},"button2Title":"Restore..."}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionStoreVariable","parameters":{"name":"Action","value":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"If \"Backup\" was selected...","class":"WorkflowActionCondition","parameters":{"comparisonType":0,"expression2":{"type":"advancedText","tokenRanges":{},"text":"backup"},"expression1":{"type":"advancedText","tokenRanges":{"{0, 1}":"Action"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"Create the Backup (Python)","class":"WorkflowActionRunScript","parameters":{"script":"#coding: utf-8\nimport workflow\nimport editor\nimport os\nfrom zipfile import ZipFile\nimport datetime\nfrom io import BytesIO\nimport json\nimport shutil\n\nt = datetime.datetime.today()\nbackup_filename = 'EditorialBackup_' + t.strftime('%Y_%m_%d-%H_%M') + '.zip'\nwf_path = editor.get_workflows_path()\nwf_files = os.listdir(wf_path)\nsnpt_path = os.path.expanduser('~\/Library\/Application Support\/Snippets')\nsnpt_files = os.listdir(snpt_path)\n\nzip_buffer = BytesIO()\nwith ZipFile(zip_buffer, 'w') as z:\n\t# Backup workflows:\n\tfor filename in wf_files:\n\t\tname, extension = os.path.splitext(filename)\n\t\tif extension in ('.wkflw', '.edcmd'):\n\t\t\tz.write(filename)\n\t# Backup snippets:\n\tos.chdir(snpt_path)\n\tfor filename in snpt_files:\n\t\tname, extension = os.path.splitext(filename)\n\t\tif extension in ('.snpt', '.edcmd'):\n\t\t\tz.write(filename)\n\t# Backup bookmarks\n\tz.writestr('EditorBookmarks.json', json.dumps(editor.get_bookmarks('editor')))\n\tz.writestr('BrowserBookmarks.json', json.dumps(editor.get_bookmarks('browser')))\n\t# Backup local documents:\n\tdoc_path = os.path.expanduser('~\/Documents')\n\tshutil.make_archive('Documents', 'zip', doc_path)\n\tz.write('Documents.zip')\n\tos.remove('Documents.zip')\n\nzip_data = zip_buffer.getvalue()\neditor.set_file_contents(backup_filename, zip_data, 'dropbox')\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionShowHUD","parameters":{"HUDText":{"type":"advancedText","tokenRanges":{},"text":"Backup Created"},"duration":1,"icon":0}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionConditionEnd","parameters":{}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"If \"Restore\" was selected....","class":"WorkflowActionCondition","parameters":{"comparisonType":0,"expression2":{"type":"advancedText","tokenRanges":{},"text":"restore"},"expression1":{"type":"advancedText","tokenRanges":{"{0, 1}":"Action"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"List Backups (Python)","class":"WorkflowActionRunScript","parameters":{"script":"#coding: utf-8\nimport workflow\nimport editor\nimport os\nimport re\n\nwf_path = editor.get_workflows_path()\ndb_path = os.path.join(os.path.split(wf_path)[0], 'Dropbox')\n\nbackups = []\nfiles = os.listdir(db_path)\nfor filename in files:\n\tif re.match('EditorialBackup_.*\\\\.zip$', filename):\n\t\tbackups.append(filename)\nworkflow.set_output('\\n'.join(backups))\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"Stop if no backups are found...","class":"WorkflowActionCondition","parameters":{"comparisonType":0,"expression2":{"type":"advancedText","tokenRanges":{},"text":""},"expression1":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionShowAlert","parameters":{"button2Value":{"type":"advancedText","tokenRanges":{},"text":""},"button1Title":"","button1Value":{"type":"advancedText","tokenRanges":{},"text":""},"showCancelButton":false,"title":"No Backups Found","message":{"type":"advancedText","tokenRanges":{},"text":"No backup files were found. You might need to download them first, if you see grayed-out backup files in your Dropbox folder."},"button3Title":"","button3Value":{"type":"advancedText","tokenRanges":{},"text":""},"button2Title":""}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionStopWorkflow","parameters":{"showHUD":false,"HUDTitle":"","stopOption":0}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionConditionEnd","parameters":{}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionSelectFromList","parameters":{"title":"Select a Backup","list":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"},"showInPopover":false,"allowMultipleSelection":false}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"Show Warning Alert","class":"WorkflowActionShowAlert","parameters":{"button2Value":{"type":"advancedText","tokenRanges":{},"text":""},"button1Title":"Continue","button1Value":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"},"showCancelButton":true,"title":"Warning","message":{"type":"advancedText","tokenRanges":{"{133, 1}":"Input"},"text":"This will replace all your workflows, snippets, bookmarks, and local documents with the ones that are stored in the selected backup (?).\n\nDocuments that are synced with Dropbox will not be changed."},"button3Title":"","button3Value":{"type":"advancedText","tokenRanges":{},"text":""},"button2Title":""}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"Restore the Backup (Python)","class":"WorkflowActionRunScript","parameters":{"script":"#coding: utf-8\nimport workflow\nimport editor\nfrom os import path\nimport os\nfrom zipfile import ZipFile\nimport shutil\nimport json\n\nbackup_filename = workflow.get_input()\ndb_path = path.join(path.split(editor.get_workflows_path())[0], 'Dropbox')\nbackup_path = path.join(db_path, backup_filename)\n\nwith ZipFile(backup_path, 'r') as z:\n\tz.extractall(editor.get_workflows_path())\nwf_path = editor.get_workflows_path()\nsnpt_path = os.path.expanduser('~\/Library\/Application Support\/Snippets')\nfiles = os.listdir(wf_path)\nfor filename in files:\n\tif filename == 'Snippets.edcmd' or path.splitext(filename)[1] == '.snpt':\n\t\tshutil.move(os.path.join(wf_path, filename), os.path.join(snpt_path, filename))\n\tif filename == 'EditorBookmarks.json':\n\t\twith open(os.path.join(wf_path, filename), 'r') as f:\n\t\t\tbookmarks = json.load(f)\n\t\t\teditor.set_bookmarks(bookmarks, 'editor')\n\t\tos.remove(os.path.join(wf_path, filename))\n\tif filename == 'BrowserBookmarks.json':\n\t\twith open(os.path.join(wf_path, filename), 'r') as f:\n\t\t\tbookmarks = json.load(f)\n\t\t\teditor.set_bookmarks(bookmarks, 'browser')\n\t\tos.remove(os.path.join(wf_path, filename))\n\tif filename == 'Documents.zip':\n\t\tdoc_path = os.path.expanduser('~\/Documents')\n\t\twith ZipFile(filename, 'r') as docszip:\n\t\t\tnames = docszip.namelist()\n\t\t\tfor name in names:\n\t\t\t\tif not name.startswith('Inbox\/'):\n\t\t\t\t\tdocszip.extract(name, doc_path)\n\t\tos.remove(os.path.join(wf_path, filename))\n\neditor.reload_workflows()\neditor.reload_files()\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionShowHUD","parameters":{"HUDText":{"type":"advancedText","tokenRanges":{},"text":"Backup Restored"},"duration":1,"icon":0}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionConditionEnd","parameters":{}}]}