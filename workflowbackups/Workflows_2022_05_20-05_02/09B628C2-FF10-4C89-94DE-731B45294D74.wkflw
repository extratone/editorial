{"actions":[{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionRunScript","parameters":{"script":"#coding: utf-8\nimport workflow\n\nworkflow.set_output('https:\/\/www.glassdoor.com\/Reviews\/Walt-Disney-Company-Reviews-E717.htm')\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionOpenURL","parameters":{"openIn":0,"URL":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"},"revealBrowserAutomatically":true,"tabOption":2,"tabID":"glassdoorloggedin","waitUntilLoaded":true}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionRunScript","parameters":{"script":"from time import sleep\n\nsleep(4)\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionEvaluateJavascript","parameters":{"script":"\/\/This sets the output of the workflow action:\n\nfunction first_tab(url_base) {\n    var winFront = safari.windows[0]\n\tvar tab = winFront.tabs[0]\n\tsafari.doJavaScript(\"location.href='\"+url_base+\"'\", { in: tab })\n    return tab\n}\n\nfunction str(fun) {\n  return \"(\" + fun + \")()\" \n}\n\n\nfunction scrapeThisPageReviews(i) { \n    sessionStorage.clear()\n\t$('div.hreview').each(function() {\n\t\t\t\t\t      var _res = {}\n\t\t\t\t\t\t var subratings = {}\n                       $(this).find('div.subRatings').find('ul.undecorated').find('li').each(function() { \n\t\t\t\t\t   var cat_name = $(this).find('.minor').text()\n\t\t\t\t\t   var rating = $(this).find('span.gdBars').attr('title'); \n\t\t\t\t\t     subratings[cat_name]=rating\n\t\t\t\t\t   })\n\t\t\t\t\t\n\t\t\t\t\t\t_res['subratings']=subratings\n\t\t\t\t       _res['helpful'] = $(this).find('.helpfulCount').text()\n\t\t\t\t\t   _res['pros'] = $(this).find('div p.strong:contains(Pro)').next('p').text()\n\t\t\t\t\t  _res['cons'] = $(this).find('div p.strong:contains(Con)').next('p').text()\n\t\t\t\t\t  _res['advice_to_mgmt'] = $(this).find('div p.strong:contains(Advice)').next('p').text()\n\t\t\t\t\t  _res['positive_boxes'] = $(this).find('i.green').parent('div').next('div').find('.middle').map(function() { return this.innerText }).toArray()\n\t\t\t\t\t  _res['neutral_boxes'] = $(this).find('i.yellow').parent('div').next('div').find('.middle').map(function() { return this.innerText }).toArray()\n\t\t\t\t\t  _res['negative_boxes'] = $(this).find('i.red').parent('div').next('div').find('.middle').map(function() { return this.innerText }).toArray()\n\t\t\t\t\t  _res['author_jobtitle'] = $(this).find('span.authorJobTitle').text()\n\t\t\t\t\t  _res['author_location'] = $(this).find('span.authorLocation').text()\n\t\t\t\t\t  _res['review_title'] = $(this).find('a.reviewLink span.summary').text()\n\t\t\t\t\t    _res['rating'] = $(this).find('span.rating span.value-title').attr('title')\n\t\t\t\t\t      _res['date'] = $(this).find('time').text()\n\t\t\t\t\t  i++;\n\tsessionStorage.setItem(i.toString(), JSON.stringify(_res))\n\t\t\t\t\t  })\t\n\t\t\t\t\t  return i\n}\n\nvar num_scraped = scrapeThisPageReviews(0)\nvar next_link;\nnext_link = $($('li.next').find('a')[0]).attr('href')\n\nif(true) {\n   \/\/location.href = next_link\n   setTimeout(function() { num_scraped= scrapeThisPageReviews(num_scraped)}, 8000)\n   $('li.next').find('a').click()\n}\nwindow.output = next_link \/\/num_scraped\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionConsoleOutput","parameters":{"text":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"}}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionRunScript","parameters":{"script":"from time import sleep\n\nsleep(4)\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionEvaluateJavascript","parameters":{"script":"function fetchScrapedDataFromThisPage() {\n   var res=[],i=0; \n\twhile(sessionStorage.key(i) != null) { \n\t\tres.push(JSON.parse(sessionStorage.getItem(sessionStorage.key(i)))); i++; \n\t}\n\treturn JSON.stringify(res)\n}\n\nwindow.output = fetchScrapedDataFromThisPage()\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionConsoleOutput","parameters":{"text":{"type":"advancedText","tokenRanges":{"{0, 1}":"Input"},"text":"?"}}}]}