{"actions":[{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionRunScript","parameters":{"script":"#coding: utf-8\nimport workflow\nimport difflib\nimport clipboard\nimport re\nimport editor\nimport console\n\ndef main():\n\ttext1 = clipboard.get()\n\tif not text1:\n\t\tconsole.hud_alert('Clipboard Empty', 'error')\n\t\tworkflow.stop()\n\t\treturn\n\ttext2 = editor.get_text()\n\tif not text2:\n\t\tconsole.hud_alert('No Text in Editor', 'error')\n\t\tworkflow.stop()\n\t\treturn\n\td = difflib.Differ()\n\tlines1 = text1.splitlines()\n\tlines2 = text2.splitlines()\n\tout_lines = []\n\tdiff_lines = list(d.compare(lines1, lines2))\n\tfor i, line in enumerate(diff_lines):\n\t\tif line.startswith('+'):\n\t\t\tout_lines.append('<pre class=\"diffline added\">%s<\/pre>' % line[2:])\n\t\telif line.startswith('-'):\n\t\t\tout_lines.append('<pre class=\"diffline deleted\">%s<\/pre>' % line[2:])\n\t\telif line.startswith('?') and i > 0:\n\t\t\tprev_line = diff_lines[i-1]\n\t\t\tranges = [(m.start(), m.end()) for m in re.finditer(r'\\++|-+', line)]\n\t\t\tfor start, end in reversed(ranges):\n\t\t\t\tspan_tag = '<span class=\"%s-highlight\">' % ('deleted' if line[start] == '-' else 'added')\n\t\t\t\tprev_line = prev_line[:start] + span_tag + prev_line[start:end] + '<\/span>' + prev_line[end:]\n\t\t\tpre_tag = '<pre class=\"diffline %s\">' % ('added' if prev_line.startswith('+') else 'deleted')\n\t\t\tout_lines[i-1] = '%s%s<\/pre>' % (pre_tag, prev_line[2:],)\n\t\t\tout_lines.append('')\n\t\telse:\n\t\t\tout_lines.append('<pre class=\"common\">%s<\/pre>' % line[2:])\n\t\n\tworkflow.set_output('\\n'.join(out_lines))\n\nmain()\n"}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionShowHTMLPreview","parameters":{"title":"Diff","html":{"type":"advancedText","tokenRanges":{"{763, 1}":"Input"},"text":"<!DOCTYPE html>\n<html>\n<head><meta charset=\"utf-8\"\/>\n<style type=\"text\/css\">\nbody {\n\tbackground-color: #f6f6f6;\n\tcolor: #333;\n\tmargin: 16px;\n}\npre {\n\tfont-family: Menlo, monospace;\n\twhite-space: pre-wrap;\n\tmargin-top: 0;\n\tmargin-bottom: 0;\n\toverflow: hidden;\n}\npre.diffline {\n\tborder-width: 0 0 0 8px;\n\tmargin-left: -16px;\n\tmargin-right: -16px;\n\tpadding-right: 16px;\n\tpadding-left: 8px;\n\tborder-style: solid;\n}\n.added {\n\tcolor: green;\n\tbackground-color: #f4fbef;\n\tborder-color: #c9ffb3;\n}\n.deleted {\n\tcolor: #820e03;\n\tbackground-color: #fbefef;\n\tborder-color: #ffb3b4;\n}\n.deleted-highlight {\n\tbackground-color: #ffb3b4;\n\tborder-radius: 3px;\n}\n.added-highlight {\n\tbackground-color: #c9ffb3;\n\tborder-radius: 3px;\n}\n.common {\n\tcolor: #999;\n}\n<\/style>\n<\/head>\n<body>\n?\n<\/body>\n<\/html>"},"baseURL":""}}]}